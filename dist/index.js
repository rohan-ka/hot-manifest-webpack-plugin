'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var _require=require('path'),resolve=_require.resolve,fs=require('fs'),mkdirp=require('mkdirp');module.exports=function(){function a(b){var c=b.isHot,d=b.port,e=b.path,f=b.filename,g=void 0===f?'hot-manifest.json':f;_classCallCheck(this,a),this.isHot=c,this.port=d,this.path=e,this.filename=g,this.manifestPath=resolve(e,g)}return _createClass(a,[{key:'deleteHotManifest',value:function deleteHotManifest(){var a=this;return new Promise(function(b){fs.unlink(a.manifestPath,function(){return b()})})}},{key:'createBuildDirectory',value:function createBuildDirectory(){var a=this;return new Promise(function(b,c){mkdirp(a.path,function(a){return a?c(a):b()})})}},{key:'writeManifest',value:function writeManifest(a){var b=this;return new Promise(function(c,d){fs.writeFile(b.manifestPath,a,function(a){return a?d(a):c()})})}},{key:'apply',value:function apply(a){var b=this,c=JSON.stringify({port:this.port});a.plugin('emit',function(a,d){b.isHot?b.createBuildDirectory().then(function(){return b.writeManifest(c)}).then(function addManifestAsset(){a.assets[b.filename]={source:function source(){return c},size:function size(){return c.length}}}).then(d):b.deleteHotManifest().then(d)})}}]),a}();